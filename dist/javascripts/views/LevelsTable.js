define(["backbone","underscore","collections/Levels","routers/Router","models/level"],function(){return LevelsTable=Backbone.View.extend({el:"#levelsTable",template:_.template("<tr id='<%= cid %>'><td><%= checkTime %></td><td> <%= amnt %></td><td><%= insulin %></td></tr>"),initialize:function(){_.bindAll(this,"render","buildTable","saveLocalStorage"),this.listenTo(this.collection,"add",this.render),this.buildTable()},buildTable:function(){var e=this;for(var t=0;t<localStorage.length;t++){if(localStorage.key(t)==="user")continue;data=localStorage.getItem(localStorage.key(t)),JsonData=JSON.parse(data),record=new Level(JsonData),console.log(record),this.$el.append(this.template(record.toJSON()))}},render:function(e){this.saveLocalStorage(e),this.$el.append(this.template(e.toJSON())),this.animateTableAdd($("#"+e.cid))},animateTableAdd:function(e){e.css("display","none"),setTimeout(function(){e.fadeIn(300).fadeOut(300).fadeIn(300)},800)},saveLocalStorage:function(e){str=JSON.stringify(e.toJSON()),localStorage.setItem(e.cid,str),console.log(str)}}),new LevelsTable({collection:Router.Levels})});